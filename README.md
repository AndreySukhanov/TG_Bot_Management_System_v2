# Telegram Bot Management System

Система управления финансами и аналитики для Telegram бота с веб-дашбордом.

## Возможности

- **Управление балансом**: Пополнение, списание, контроль расходов
- **Роли пользователей**: Маркетологи, финансисты, руководители
- **AI-помощник**: Аналитика и ответы на вопросы (OpenAI)
- **Веб-дашборд**: Графики, статистика, управление
- **NLP обработка**: Естественный язык для команд
- **Уведомления**: Автоматические уведомления о событиях

## Быстрый старт

### 1. Установка

```bash
# Клонировать репозиторий
git clone <repository_url>
cd telegram-bot-management

# Создать виртуальное окружение
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# Установить зависимости
pip install -r requirements.txt
```

### 2. Настройка

```bash
# Скопировать пример конфигурации
cp .env.example .env

# Отредактировать .env файл
nano .env
```

**Обязательные настройки в .env:**
- `BOT_TOKEN` - токен Telegram бота
- `MARKETERS` - ID пользователей-маркетологов
- `FINANCIERS` - ID пользователей-финансистов  
- `MANAGERS` - ID пользователей-руководителей
- `OPENAI_API_KEY` - ключ OpenAI API

### 3. Запуск

```bash
# Запуск бота
python main.py

# Запуск веб-дашборда (отдельный терминал)
python start_dashboard.py
```

## Структура проекта

```
├── main.py                 # Главный файл бота
├── start_dashboard.py      # Запуск веб-дашборда
├── requirements.txt        # Зависимости
├── .env.example           # Пример конфигурации
├── bot.py                 # Инициализация бота
├── handlers/              # Обработчики команд
│   ├── common.py          # Общие команды
│   ├── manager.py         # Команды руководителей
│   ├── financier.py       # Команды финансистов
│   └── marketer.py        # Команды маркетологов
├── db/                    # База данных
│   └── database.py        # Модели и операции
├── utils/                 # Утилиты
│   ├── config.py          # Конфигурация
│   ├── bot_commands.py    # Команды бота
│   └── logger.py          # Логирование
├── nlp/                   # NLP обработка
│   └── command_parser.py  # Парсинг команд
├── dashboard/             # Веб-дашборд
│   ├── main.py           # FastAPI приложение
│   ├── templates/        # HTML шаблоны
│   └── static/           # CSS/JS файлы
└── tests/                # Тесты
```

## Использование

### Команды бота

**Общие команды:**
- `/start` - Запуск бота
- `/help` - Справка
- `/menu` - Главное меню

**Для руководителей:**
- `/balance` - Текущий баланс
- `/stats` - Статистика системы
- `/ai` - AI-помощник
- `/dashboard` - Веб-дашборд
- `/resetbalance` - Обнулить баланс

**Для финансистов:**
- `/balance` - Показать баланс

**Для маркетологов:**
- Отправка сообщений с суммой для пополнения

### Веб-дашборд

Доступен по адресу: `http://localhost:8000`

**Возможности:**
- Просмотр баланса и статистики
- Графики доходов/расходов
- История транзакций
- Управление системой

**Авторизация:**
- Токен: `demo_token`
- Добавить к URL: `?token=demo_token`

## Настройка ролей

Пользователи определяются по Telegram ID в файле `.env`:

```env
MARKETERS=123456789,987654321    # Маркетологи
FINANCIERS=111111111,222222222   # Финансисты  
MANAGERS=333333333,444444444     # Руководители
```

## Логирование

Логи сохраняются в файл `logs/bot.log` с уровнем INFO.

## База данных

Используется SQLite в файле `db/bot.db`. Создается автоматически при запуске.

## Разработка

### Добавление новых команд

1. Создать обработчик в соответствующем файле `handlers/`
2. Зарегистрировать команду в `utils/bot_commands.py`
3. Добавить в функцию `setup_handlers()` в `bot.py`

### Тестирование

```bash
python -m pytest tests/
```

## Требования

- Python 3.8+
- aiogram 3.x
- FastAPI
- SQLite
- OpenAI API key

## Поддержка

При возникновении проблем:

1. Проверьте логи в `logs/bot.log`
2. Убедитесь в правильности настроек в `.env`
3. Проверьте доступность API ключей
4. Создайте issue в репозитории

## Автор

Разработано Andrey Sukhanov

## Лицензия

Коммерческий проект. Все права защищены.
